(서버 접속용)공인 아이피 vs 사설 아이피
외부 IP vs 내부 IP

공인IP+외부포트 --> 비공인IP+내부포트

우리가 이용하는 프로그램은 저렇게 많음에도 불구하고 서버는 어떻게 사용자가 웹페이지 요청을 했는지 파일 요청을 했는지 구분을 할 수 있을까요?
바로 Port가 있기 때문에 서버는 요청을 받았을 때 웹사이트 요청을 했는지 FTP를 이용한 파일 요청을 받았는지 알고 처리를 할 수 있습니다.

Port는 숫자로 표현합니다.
통상적으로 웹사이트는 80번 포트, FTP 서비스는 21번 Port를 이용합니다.
클라이언트에서 요청을 하면 서버의 OS는 어느 Port로 요청이 왔는지 확인 후 해당 Port로 접속을 기다리는 Process에게 요청 내역을 전달해줍니다.
하나의 서버가 여러 역할을 할 수 있게 됩니다.

컴퓨터의 LAN선은 하나인데 통신을 필요로 하는 프로그램이 다수일 때 이 다수의 프로그램을 구별할 수 있는 번호가 Port이다.

Port-Forwarding

ex) 공유기를 기점으로 공유기 뒤에 있는 PC들의 IP를 내부 IP, 공유기의 IP를 외부 IP라고 부릅니다.
집이 아닌 다른 곳에서 PC에 있는 파일을 가져오려면 공유기에 접속을 해야 합니다.
21번 포트로 요청이 왔는데 공유기는 어느 PC로 연결을 해줘야 할 지 모르는 상태입니다.
이러한 상황에서 공유기에게 이정표를 달아주는 것을 포트포워딩 이라고 합니다.
21번 포트로 요청이 오면 공유기는 이정표를 참조해서 해당 PC로 정확하게 전달해줄 수 있습니다.

공유기-사설 네트워크

인터넷을 사용하기 위해서는 전세계적으로 사용되는 아이피(IP) 주소가 있어야하만 합니다.
아이피는 고유한 값이기 때문에 중복되는 주소를 가지지 않습니다.
그렇지만 전세계의 모든 장비에 아이피를 할당하기에는 현재의 아이피 체계가 많이 부족합니다.
그렇기 때문에 굳이 전세계적으로 네트워크가 필요하지 않은 장비들에 대해서는 별도의 사설 네트워크를 구축하게 됩니다.

앞서 언급한 인터넷이 가능한 아이피를 공인(Public) 아이피라고 합니다.
이러한 공인 아이피는 고유한 값으로 인터넷을 사용하는 기기에 하나씩 할당됩니다.

그런데 이런 공인 아이피에서 몇몇 아이피 대역은 사용되지 않습니다.

10.x.x.x 대역, 172.16~31.x.x 대역, 그리고 192.168.x.x 대역이 모두 사용되지 않습니다.

이러한 아이피 대역은 회사나 개인 등이 별도로 구축하게 될 사설 네트워크에서만 이용됩니다.

사설 네트워크는 전세계적인 인터넷이 아닌 국지적인 네트워크로써 굳이 인터넷이 필요하지 않은 경우에 사용됩니다.

본래 이러한 사설 네트워크를 구축하기 위해서는 DHCP 서버와 라우터 등등이 필요하지만, 이러한 기능이 하나로 뭉쳐있는 개인용 장비가 공유기입니다.

공유기의 역할은 간단합니다. 공유기에 연결되는 모든 기기들에 사설 네트워크를 구축해주는 것입니다.
사설 네트워크이기 때문에 위에서 언급했던 공인 아이피 대역을 사용하지 않고 사설 아이피 대역을 이용하게 됩니다.

주로 이용되는 아이피 대력이 바로 192.168.x.x 입니다.

이처럼 192.168 로 시작되는 아이피 주소를 가진 장비는 인터넷에 접속하기 위해서 반드시 공인 아이피를 보유한 장비가 필요합니다.

공유기는 사설 네트워크를 만들면서 동시에 공인 아이피를 하나 할당 받습니다.

그래서 공유기에 연결된 모든 장비는 인터넷에 접근하기 위해서 반드시 공유기를 거쳐야만 합니다.

포트 포워딩이 필요한 이유

이제 컴퓨터 1에 웹서버를 80번 포트로 열었다고 생각.
인터넷을 통해서 다른 사람들이 컴퓨터 1의 웹서버에 접근하기 위해서는 컴퓨터 1의 아이피를 알려줄 수는 없습니다.
사설 아이피 대역은 여기 저기서 사용하기 때문에 공인 아이피처럼 특정한 기기를 가리키지 않습니다.
그래서 공유기가 보유한 공인 아이피를 알려줘야 합니다.
그러면 다른 사람들이 "공인 아이피":컴퓨터 1의 포트 주소를 인터넷 브라우저에 입력하면 웹 서버에 연결이 될까?
공인 아이피의 포트로 들어오는 연결은 공유기에 도달하면 끝나버립니다.
왜냐하면 공인 아이피로 들어온 포트의 연결을 공유기에서 컴퓨터 1, 2, 3 중에 어떤 곳으로 보내줘야 할 것인지를 판단하지 못하기 때문
그렇기 때문에 공인 아이피로 들어오는 포트의 연결을 컴퓨터 1의 포트로 연결하라고 공유기에 설정을 해야 하는 것이며, 이것을 포트 포워딩이라고 하는 것입니다.

포워딩하고자 하는 아이피는 반드시 공유기가 할당한 사설 아이피여야만 합니다.

서비스 포트란?

하나의 컴퓨터에서 S/W 등을 구동하고 있을 때 구분하기 쉽게 하도록 지정해놓은 꼬리표라고 생각하시면 됩니다.
예를 들어 제 컴퓨터에서 A라는 서비스를 구동하고 있습니다.
하나의 컴퓨터에서 A라는 서비스 하나만 사용할 때에는 문제가 되지 않지만 현대의 컴퓨터에서는 그러지 않겠죠

제 컴퓨터의 IP는 192.168.1.100 라고 할 때 A라는 서비스에 접속을 할 때에는 특별한 문제는 없지만 B라는 서비스를 같이 사용할 때 IP만 사용하여서는 어떤 서비스를 사용할 것인지 구분할 수 없습니다.
그렇기 때문에 A라는 서비스에 1번이라는 번호를 부여하고 B라는 서비스에 100이라는 번호를 부여해봅니다.
이게 "서비스 포트"라는 개념이죠
서비스 포트를 입력할 때에는 "IP주소:서비스포트 숫자" 라는 방식을 사용합니다.
그렇게 되면 제가 A라는 서비스를 이용하고 싶을 때에는 192.168.1.100:1 이라고 쓰면 A라는 서비스를 지칭하는 것이고
192.168.1.100:100이라고 쓰면 B라는 서비스를 지칭하는 것을 구분할 수 있습니다.

이제 A와 B에 대한 서비스를 구분할 수 있겠네요.
생략해서 포트번호라고도 합니다.
다른 사람들과 서비스 포트에 대한 이야기를 나눌 때 "zz접속하는 포트번호가 뭐야?" 라는 식의 대화도 가능하겠습니다.

기본 서비스 포트

이처럼 여러 서비스를 구분하기 위해 번호를 지정하여 구분하도록 만든 것이 서비스 포트입니다.
그 중에서도 예약, 지정된 포트들이 있는데요. 그 중 유명한 port들은 아래를 참조
TCP/UDP의 포트 목록
0번 ~ 1023번: 잘 알려진 포트 (well-known port)
1024번 ~ 49151번: 등록된 포트 (registered port)
49152번 ~ 65535번: 동적 포트 (dynamic port)
ex) 
22	TCP		시큐어 셸 (SSH, Secure SHell) - ssh scp, sftp같은 프로토콜 및 포트 포워딩
80	TCP	UDP	HTTP (HyperText Transfer Protocol) - 웹 페이지 전송

기본적으로 ssh를 설정하게 되면 22번 포트로 설정되어 있고 http를 구성하게 되면 80번 포트로 설정됩니다.
기본 설정으로 들어가있다.

이 포트 번호들은 수정할 수 없는 번호가 아닌 권고값들입니다.
개인 또는 단체의 사용 용도에 따라 설정을 통해 포트번호를 변경할 수 있다는 뜻

특별한 포트번호

80포트라는 포트번호가 있습니다. 위와 같이 http를 사용할 때 기본적으로 적용되어 있는 포트
이 80포트는 특별합니다. 생략이 되는 포트번호입니다.
모든 사람들이 사용한다는 말이 이 부분입니다.
google에 접속하기 위해서는 정확한 주소는 http://www.google.com:80 입니다.
하지만 80은 생략이 가능하므로 http://www.google.com 이라고만 입력해여도 접속이 가능하다는 것
대부분의 포털사이트들은 80포트를 사용합니다. 일반 사용자들의 편의를 위해 :포트번호를 쓰지않아도 되도록

포트포워딩의 필요성

내부네트워크 또는 네트워크에 연결되지 않은 하나의 호스트만 사용하는 서비스들이라면 필요가 없는 기능입니다.

그러나 자주 거론되는 이유는 과거와 다르게 IT의 발달로 인하여 외부에서 제공하는 서비스 등을 제공받거나 제공해주기 위하여 개발되었기 때문

또 공유기에 하나의 호스트만 붙어있지 않습니다.

스마트폰을 이용하여 무선공유기에 접속을 하여도 호스트가 되는 것

그리고 내부 IP는 특별한 작업을 거치지 않는 한 외부에서 접속할 수 없습니다. 오로지 외부 IP를 통해서만 접속이 가능하죠

제 공유기에 연결된 호스트가 3개라고 가정을 할 때 3개 모두 ssh를 작동중입니다. (3개 모두 ssh는 기본값인 22포트)

이 때 공유기에 연결된 호스트들의 내부 IP들은 각각 192.168.1.100~102

세번째 호스트에서 첫번째 호스트의 ssh 접속을 하고자 한다면 어떻게 해야할까?
192.168.1.100:22 라고 입력을 한다면 첫번째 호스트에 22포트로 접속한다

하지만 외부에서 접속을 할 때에는 다르다
서비스포트를 이용하여 외부에서도 접속을 가능하도록 해야하는데

외부에서 첫번째 호스트를 ssh로 접속하고자 할 때 내부IP인 192.168.1.100 을 볼 수 없다
내 공유기의 공인(외부)IP가 211.123.123.123 이라고 할 때 211.123.123.123:22를 입력해도 첫번째 호스트의 ssh로 접속할 수 없다.
저 IP 주소가 공유기를 지칭하는지 첫번째 호스트를 말하는지 두번째, 세번째는 말하는건지 알 수 없기 때문
이를 해결하기 위해 나온게 포트포워딩

포트포워딩의 기능

외부에서 첫번째 호스트의 ssh로 접속하고 싶다.

이럴땐 공유기에서 구분하면 된다.
"외부에서 특정 포트번호로 들어오게 된다면 첫번째 호스트의 22번 포트를 지칭하는 것이다"라는 규칙을 설정하면 됨

공유기의 공인IP(외부IP) 뒤에 서비스포트번호처럼 특정 포트번호를 입력하면 지정한 내부 호스트의 특정포트로 보내버리는 것

포트포워딩 설정 시 1000-1010 포트로 들어오는 것들을 첫번째 호스트의 22포트로 보내라 라는 규칙을 설정

공유기의 공인IP가 211.123.123.123 이므로 211.123.123.123:1000 또는 1000~1010 까지의 숫자를 입력하면 세번째 호스트가 192.168.1.100:22 라는 주소를 입력한 것과 동일하게 접속이 가능하게 됨

이처럼 외부에서 접속 시 어떤 호스트의 어떤 서비스포트에 연결을 해주는지 설정을 해주는 것을 포트포워딩이라 합니다.
